# 2019-7-30

`y`ï¼ˆç²˜è¿ï¼ˆstickyï¼‰ï¼‰ä¿®é¥°ç¬¦ï¼Œç”¨æ³•ä¸ `g` ä¿®é¥°ç¬¦ç±»ä¼¼ï¼Œéƒ½æ˜¯å…¨å±€åŒ¹é…ï¼Œåä¸€æ¬¡åŒ¹é…éƒ½ä»ä¸Šä¸€æ¬¡åŒ¹é…æˆåŠŸçš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œä¸åŒä¹‹å¤„åœ¨äºï¼Œ`g` ä¿®é¥°ç¬¦åªè¦å‰©ä½™ä½ç½®ä¸­å­˜åœ¨åŒ¹é…å°±å¯ï¼Œè€Œ `y` ä¿®é¥°ç¬¦ç¡®ä¿åŒ¹é…å¿…é¡»ä»å‰©ä½™çš„ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œè¿™ä¹Ÿå°±æ˜¯â€œç²˜è¿â€çš„æ¶µä¹‰ï¼Œå› æ­¤ï¼Œåœ¨åŒ¹é…æ—¶ï¼Œ`y` ä¿®é¥°ç¬¦èƒ½ç¡®ä¿ä¸ä¼šæœ‰æ¼æ‰çš„å­—ç¬¦

```JavaScript
var s = 'aaa_aa_a';
var r1 = /a+/g;
var r2 = /a+/y;

r1.exec(s) // ["aaa"]
r2.exec(s) // ["aaa"]

r1.exec(s) // ["aa"]
r2.exec(s) // null
```

`y` ä¿®é¥°ç¬¦ä½¿ç”¨ `match` æ–¹æ³•ï¼Œåªèƒ½è¿”å›ç¬¬ä¸€æ¬¡åŒ¹é…çš„å†…å®¹ï¼Œéœ€è¦ä¸ `g` ä¿®é¥°ç¬¦è”ç”¨ï¼Œæ‰èƒ½å‘æŒ¥æœ€å¤§åŠŸæ•ˆ

```JavaScript
'a1a2a3'.match(/a\d/y) // ["a1"]
'a1a2a3'.match(/a\d/gy) // ["a1", "a2", "a3"]
```

ä½¿ç”¨ `RegExp.prototype.sticky` å±æ€§å¯ä»¥æ£€æŸ¥æ­£åˆ™å¯¹è±¡æ˜¯å¦ä½¿ç”¨äº† `y` ä¿®é¥°ç¬¦

ä½¿ç”¨ `RegExp.prototype.flags` å±æ€§ä¼šè¿”å›æ­£åˆ™çš„ä¿®é¥°ç¬¦

`s` ä¿®é¥°ç¬¦+è¡¨ç¤º `dotAll` æ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸ºè®© `.` èƒ½å¤Ÿä»£è¡¨ä¸€åˆ‡çš„å•ä¸ªå­—ç¬¦ï¼Œç”šè‡³æ˜¯ `u` æ¨¡å¼ä¸‹æ— æ³•åŒ¹é…çš„è¡Œç»ˆæ­¢ç¬¦

ä½¿ç”¨ `RegExp.prototype.dotAll` å±æ€§æ£€æŸ¥è¯¥æ­£åˆ™æ˜¯å¦æ˜¯ `dotAll` æ¨¡å¼

```JavaScript
const re = /foo.bar/s;
// å¦ä¸€ç§å†™æ³•
// const re = new RegExp('foo.bar', 's');

re.test('foo\nbar') // true
re.dotAll // true
re.flags // 's'
```

å…ˆè¡Œæ–­è¨€å’Œå…ˆè¡Œå¦å®šæ–­è¨€ï¼Œæ‹¬å·ä¸­çš„éƒ¨åˆ†æ˜¯ä¸è®¡å…¥ç»“æœçš„

```JavaScript
// åŒ¹é…å¿…é¡»åœ¨ % ä¹‹å‰çš„æ•°å­—
/\d+(?=%)/.exec('100% of US presidents have been male')  // ["100"]
// åŒ¹é…å¿…é¡»ä¸åœ¨ % ä¹‹å‰çš„æ•°å­—
/\d+(?!%)/.exec('thatâ€™s all 44 of them')                 // ["44"]
```

æ–°å¢çš„åè¡Œæ–­è¨€å’Œåè¡Œå¦å®šæ–­è¨€ï¼Œæ‹¬å·ä¸­çš„éƒ¨åˆ†ä¹Ÿä¸è®¡å…¥ç»“æœï¼Œä¼šå…ˆåŒ¹é…æ¡ä»¶ä¹‹åçš„å­—ç¬¦ï¼Œåœ¨å›åˆ°æ‹¬å·å†…åŒ¹é…æ‹¬å·å†…çš„éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯â€œå…ˆå³åå·¦â€ï¼Œä¸å…¶ä»–æ­£åˆ™ç›¸åï¼Œä¼šå¯¼è‡´ä¸€äº›å¥‡æ€ªçš„è¡Œä¸ºï¼Œå¹¶ä¸”åæ–œæ å¼•ç”¨ï¼Œä¹Ÿä¸é€šå¸¸çš„é¡ºåºç›¸å

```JavaScript
// åŒ¹é…å¿…é¡»åœ¨ $ ä¹‹åçš„æ•°å­—
/(?<=\$)\d+/.exec('Benjamin Franklin is on the $100 bill')  // ["100"]
// åŒ¹é…å¿…é¡»ä¸åœ¨ $ ä¹‹åçš„æ•°å­—
/(?<!\$)\d+/.exec('itâ€™s is worth about â‚¬90')                // ["90"]

/(?<=(\d+)(\d+))$/.exec('1053') // ["", "1", "053"]
/^(\d+)(\d+)$/.exec('1053') // ["1053", "105", "3"]
```

`\p{...}` å’Œ `\P{...}`ï¼Œå…è®¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ç¬¦åˆ Unicode æŸç§å±æ€§çš„æ‰€æœ‰å­—ç¬¦ï¼Œå¤§å†™çš„æ˜¯å°å†™çš„åå‘åŒ¹é…ï¼Œä»…å¯¹ Unicode æœ‰æ•ˆï¼Œæ‰€ä»¥ä½¿ç”¨æ—¶å¿…é¡»å¸¦æœ‰ `u` ä¿®é¥°ç¬¦

```JavaScript
const regexGreekSymbol = /\p{Script=Greek}/u;
regexGreekSymbol.test('Ï€') // true

\p{UnicodePropertyName=UnicodePropertyValue}

// æœ‰çš„å±æ€§å¯ä»¥åªå†™å±æ€§åæˆ–è€…å±æ€§å€¼
\p{UnicodePropertyName}
\p{UnicodePropertyValue}

const regex = /^\p{Decimal_Number}+$/u;
regex.test('ğŸğŸğŸ‘ğŸœğŸğŸğŸ©ğŸªğŸ«ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸºğŸ»ğŸ¼') // true
// åŒ¹é…æ‰€æœ‰æ•°å­—
const regex = /^\p{Number}+$/u;
regex.test('Â²Â³Â¹Â¼Â½Â¾') // true
regex.test('ã‰›ã‰œã‰') // true
regex.test('â… â…¡â…¢â…£â…¤â…¥â…¦â…§â…¨â…©â…ªâ…«') // true

// åŒ¹é…æ‰€æœ‰ç©ºæ ¼
\p{White_Space}

// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰å­—æ¯ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \w
[\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]

// åŒ¹é…å„ç§æ–‡å­—çš„æ‰€æœ‰éå­—æ¯çš„å­—ç¬¦ï¼Œç­‰åŒäº Unicode ç‰ˆçš„ \W
[^\p{Alphabetic}\p{Mark}\p{Decimal_Number}\p{Connector_Punctuation}\p{Join_Control}]

// åŒ¹é… Emoji
/\p{Emoji_Modifier_Base}\p{Emoji_Modifier}?|\p{Emoji_Presentation}|\p{Emoji}\uFE0F/gu

// åŒ¹é…æ‰€æœ‰çš„ç®­å¤´å­—ç¬¦
const regexArrows = /^\p{Block=Arrows}+$/u;
regexArrows.test('â†â†‘â†’â†“â†”â†•â†–â†—â†˜â†™â‡â‡â‡‘â‡’â‡“â‡”â‡•â‡–â‡—â‡˜â‡™â‡§â‡©') // true
```

æ­£åˆ™ä¸­å¯ä»¥ä½¿ç”¨åœ†æ‹¬å·è¿›è¡Œç»„çš„åŒ¹é…ï¼Œä½¿ç”¨ `exec()` èƒ½å°†åŒ¹é…ç»“æœæå–å‡ºæ¥

```JavaScript
const RE_DATE = /(\d{4})-(\d{2})-(\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj[1]; // 1999
const month = matchObj[2]; // 12
const day = matchObj[3]; // 31
```

ä½†æ˜¯è¿™ä¹ˆåšï¼Œæ¯ä¸€ç»„å°±æ²¡æœ‰å«ä¹‰è¿™ä¸€è¯´ï¼Œè€Œä¸”ä½¿ç”¨æ•°å­—åºå·è¦æ˜¯ç»„çš„é¡ºåºå‘ç”Ÿäº†å˜åŒ–ï¼Œå¼•ç”¨ä¹Ÿè¦ç›¸åº”çš„å˜åŒ–ï¼Œäºæ˜¯å°±æœ‰äº†å…·åç»„åŒ¹é…ï¼Œç»™æ¯ä¸€ä¸ªç»„æŒ‡å®šä¸€ä¸ªåå­—ï¼Œåƒå¯¹è±¡å±æ€§ä¸€æ ·è°ƒç”¨å³å¯ï¼Œå½“ç„¶ä½¿ç”¨æ•°å­—åºå·ä¾ç„¶æ˜¯å¯è¡Œçš„ï¼Œè‹¥æ²¡æœ‰åŒ¹é…åˆ°ï¼Œåˆ™å±æ€§å€¼æ˜¯ `undefined`

```JavaScript
const RE_DATE = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/;

const matchObj = RE_DATE.exec('1999-12-31');
const year = matchObj.groups.year; // 1999
const month = matchObj.groups.month; // 12
const day = matchObj.groups.day; // 31

const RE_OPT_A = /^(?<as>a+)?$/;
const matchObj = RE_OPT_A.exec('');

matchObj.groups.as // undefined
'as' in matchObj.groups // true
```

æ—¢ç„¶æ˜¯å¯¹è±¡ï¼Œè‡ªç„¶ä¹Ÿå°±æ”¯æŒè§£æ„èµ‹å€¼æ¥ä¸ºå˜é‡èµ‹å€¼

```JavaScript
let {groups: {one, two}} = /^(?<one>.*):(?<two>.*)$/u.exec('foo:bar');
one  // foo
two  // bar
```

ä½¿ç”¨ç”¨ `${ç»„å}` çš„æ–¹å¼å¼•ç”¨å…·åç»„ï¼Œèƒ½å¤Ÿè¿›è¡Œå­—ç¬¦ä¸²çš„æ›¿æ¢ï¼Œæ›¿æ¢éƒ¨åˆ†å¯ä»¥æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿèƒ½äº¤ç”±ä¸€ä¸ªå‡½æ•°å¤„ç†

```JavaScript
let re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/u;

// ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
'2015-01-02'.replace(re, '$<day>/$<month>/$<year>')
// '02/01/2015'

// ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°
'2015-01-02'.replace(re, (
   matched, // æ•´ä¸ªåŒ¹é…ç»“æœ 2015-01-02
   capture1, // ç¬¬ä¸€ä¸ªç»„åŒ¹é… 2015
   capture2, // ç¬¬äºŒä¸ªç»„åŒ¹é… 01
   capture3, // ç¬¬ä¸‰ä¸ªç»„åŒ¹é… 02
   position, // åŒ¹é…å¼€å§‹çš„ä½ç½® 0
   S, // åŸå­—ç¬¦ä¸² 2015-01-02
   groups // å…·åç»„æ„æˆçš„ä¸€ä¸ªå¯¹è±¡ {year, month, day}
 ) => {
 let {day, month, year} = groups;
 return `${day}/${month}/${year}`;
});
```

å¦‚æœè¦åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨å¼•ç”¨æŸä¸ªâ€œå…·åç»„åŒ¹é…â€ï¼Œå¯ä»¥ä½¿ç”¨ `\k<ç»„å>` çš„æ–¹å¼ï¼Œè€Œæ•°å­—å¼•ç”¨ï¼ˆ`\1`ï¼‰ä¾ç„¶æœ‰æ•ˆï¼Œä¸¤ç§æ–¹å¼ä¹Ÿå¯ä»¥æ··ç”¨

```JavaScript
const RE_TWICE = /^(?<word>[a-z]+)!\k<word>$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false

const RE_TWICE = /^(?<word>[a-z]+)!\1$/;
RE_TWICE.test('abc!abc') // true
RE_TWICE.test('abc!ab') // false

const RE_TWICE = /^(?<word>[a-z]+)!\k<word>!\1$/;
RE_TWICE.test('abc!abc!abc') // true
RE_TWICE.test('abc!abc!ab') // false
```

ä¸€ä¸ªæ­£åˆ™åœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æœ‰å¤šæ¬¡åŒ¹é…ï¼Œä¸€èˆ¬ä½¿ç”¨ `g` æˆ–è€… `y` ä¿®é¥°ç¬¦ï¼Œå†å¾ªç¯å–å‡º

```JavaScript
var regex = /t(e)(st(\d?))/g;
var string = 'test1test2test3';

var matches = [];
var match;
while (match = regex.exec(string)) {
  matches.push(match);
}

matches
// [
//   ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"],
//   ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"],
//   ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]
// ]
```

äºæ˜¯æœ‰äº†ä¸€ä¸ªææ¡ˆ

ææ¡ˆå¢åŠ äº†ä¸€ä¸ª `String.prototype.matchAll` çš„æ–¹æ³•ï¼Œå¯ä»¥ä¸€æ¬¡æ€§å–å‡ºæ‰€æœ‰çš„åŒ¹é…ï¼Œè¿”å›çš„ç»“æœä¸ºä¸€ä¸ªéå†å™¨ï¼ˆIteratorï¼‰ï¼Œä½¿ç”¨ `for...of` å¾ªç¯å–å‡ºï¼Œç›¸è¾ƒäºæ•°ç»„æ›´åŠ èŠ‚çœèµ„æºï¼Œä½¿ç”¨ `...` æˆ–è€… `Array.from` æ–¹æ³•å¯ä»¥å°†å…¶è½¬æ¢æˆæ•°ç»„

```JavaScript
const string = 'test1test2test3';

// g ä¿®é¥°ç¬¦åŠ ä¸åŠ éƒ½å¯ä»¥
const regex = /t(e)(st(\d?))/g;

for (const match of string.matchAll(regex)) {
  console.log(match);
}
// ["test1", "e", "st1", "1", index: 0, input: "test1test2test3"]
// ["test2", "e", "st2", "2", index: 5, input: "test1test2test3"]
// ["test3", "e", "st3", "3", index: 10, input: "test1test2test3"]

// è½¬ä¸ºæ•°ç»„æ–¹æ³•ä¸€
[...string.matchAll(regex)]

// è½¬ä¸ºæ•°ç»„æ–¹æ³•äºŒ
Array.from(string.matchAll(regex));
```

## ç®€å•æ€»ç»“

å­—ç¬¦ä¸²çš„æ‰©å±•ä¸­ï¼Œæ¨¡æ¿å­—ç¬¦ä¸²æ— ç–‘æ˜¯é‡å¤´ï¼Œè€Œ Unicode çš„æ‰©å±•åˆ™æ˜¯ä¸ºäº†è®© JavaScript æ›´å¥½çš„è¯†åˆ«å­—ç¬¦ï¼ŒåŒæ—¶ï¼Œç†è§£ Unicode çš„æ‰©å±•ä¹Ÿèƒ½ä¸ºç†è§£æ­£åˆ™è¡¨è¾¾å¼çš„æ‰©å±•æœ‰æ‰€å¸®åŠ©ï¼Œæ¯”å¦‚æ­£åˆ™è¡¨è¾¾å¼æ‰©å±•ä¸­çš„ `u` å’Œ `s` ä¿®é¥°ç¬¦

æ­£åˆ™è¡¨è¾¾å¼æ— ç–‘æ˜¯éå¸¸éš¾ä»¥ç†è§£çš„ä¸€éƒ¨åˆ†ï¼Œçµæ´»å¤šå˜ï¼Œåº”è¯¥è¯´ï¼Œæ‰©å±•çš„ä¸œè¥¿è¿˜ç®—èƒ½è®°ä¸‹æ¥ä½¿ç”¨ï¼Œä½†æ˜¯æ­£åˆ™åŸºç¡€çš„ç©æ³•å°±éœ€è¦æ›´å¤šæ—¥å¸¸çš„ä½¿ç”¨è¿›è¡Œç†Ÿæ‚‰å’Œæ·±å…¥ç†è§£äº†

æ­£åˆ™è¡¨è¾¾å¼åŸºç¡€çŸ¥è¯†äº†è§£ä¸€äº›ï¼š[æ­£åˆ™è¡¨è¾¾å¼ MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions)
